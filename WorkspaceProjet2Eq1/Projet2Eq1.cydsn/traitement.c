/* ========================================
 *
 * Copyright YOUR COMPANY, THE YEAR
 * All Rights Reserved
 * UNPUBLISHED, LICENSED SOFTWARE.
 *
 * CONFIDENTIAL AND PROPRIETARY INFORMATION
 * WHICH IS THE PROPERTY OF your company.
 *
 * ========================================
*/
#include "traitement.h"


 uint16_t indice = 0;

 uint8_t bpm = 0;
 uint8_t saturation = 0;

 uint32_t AC_red = 0;
 uint32_t DC_red = 0;
 uint32_t AC_IR = 0;
 uint32_t DC_IR = 0;

void traitementCompletSignaux(uint32_t *IR_data,  uint32_t *RED_data)
{
    // TODO: gestion de l'appel des différentes fonctions de traitement (traitement première moitiée vs deuxième, etc.)
    // Gestion de l'indice pour l'acquisition et le traitement des signaux (remise à zéro, 2 indices car 2 signal à traiter?)
    // aka gestion des buffers circulaires!!
    
    acquisitionSignaux(IR_data,RED_data, &bufferRed[indice], &bufferIR[indice], &indice);
    
    filtreSignal(&bufferRed[indice-2000],&bufferRedFiltre[indice-2000]);
    filtreSignal(&bufferIR[indice-2000],&bufferIRFiltre[indice-2000]);
    uint8_t compteurMaxIR = traitementSignal(&bufferIR[indice-2000], &bufferIRFiltre[indice-2000], &AC_IR, &DC_IR);
    
    bpm = compteurMaxIR/10*60;
    calculSaturation(AC_red, DC_red, AC_IR, DC_IR, &saturation);
    
    if(indice == 4000){
        indice = 0;
    }
}

void acquisitionSignaux(uint32_t *data_red,  uint32_t *data_IR,float32_t *bufferRed,  float32_t *bufferIR, uint16_t *indice) // taille date = 2000, taille buffer = 4000
{
    for(uint16_t i = *indice; i < 2000 + *indice; i++){
    
        bufferRed[i] = data_red[i];
        bufferIR[i] = data_IR[i];
    }
}

void filtreSignal(float32_t *buffer,float32_t *bufferFiltre) // ajouter indice comme param
{
   // TODO: FIGURE OUT LA FILTRATION

    // Coefficients trouver avec les fonctions fir1 et fliplr de matlab. Coefficients d'un filtre passe bande entre 1 et 5 Hz pour une échantillonage à 200 Hz
    //float32_t coeff[2000] = {-1.59987720980260e-06,-4.75566480052249e-06,-7.77273389110339e-06,-1.05579400724207e-05,-1.30235807709003e-05,-1.50895500558671e-05,-1.66853153290864e-05,-1.77516679906359e-05,-1.82422054503264e-05,-1.81245081556136e-05,-1.73809824893486e-05,-1.60093482867789e-05,-1.40227581465864e-05,-1.14495444681017e-05,-8.33259903035016e-06,-4.72839872877413e-06,-7.05699593990838e-07,3.65607076846908e-06,8.26868484932276e-06,1.30372070818964e-05,1.78622564786259e-05,2.26423863749674e-05,2.72765245589377e-05,3.16664153618334e-05,3.57190049663392e-05,3.93487122663879e-05,4.24795300706261e-05,4.50469052269862e-05,4.69993512771232e-05,4.82997534139468e-05,4.89263326732899e-05,4.88732442778699e-05,4.81507936834338e-05,4.67852629523225e-05,4.48183493858403e-05,4.23062276641441e-05,3.93182558495243e-05,3.59353542880125e-05,3.22480944860014e-05,2.83545422472424e-05,2.43579055539231e-05,2.03640427087370e-05,1.64788899946734e-05,1.28058704571475e-05,9.44334630260524e-06,6.48217680679638e-06,4.00344153718011e-06,2.07638515582213e-06,7.56635154525476e-07,8.47376891194566e-08,8.50493622816704e-08,7.65014519436002e-07,2.11484856020378e-06,4.10763813872721e-06,6.69985915549114e-06,9.83230336674815e-06,1.34313944957208e-05,1.74108651617811e-05,2.16737569825081e-05,2.61146980693183e-05,3.06224050329437e-05,3.50823507205514e-05,3.93795343745774e-05,4.34012878561919e-05,4.70400501012064e-05,5.01960421237471e-05,5.27797766655795e-05,5.47143399796716e-05,5.59373881698709e-05,5.64028068810859e-05,5.60819908071175e-05,5.49647082846489e-05,5.30595259712077e-05,5.03937790371170e-05,4.70130831921132e-05,4.29803959583499e-05,3.83746456271411e-05,3.32889570299522e-05,2.78285133527778e-05,2.21081024764866e-05,1.62494045009442e-05,1.03780839980834e-05,4.62075595758656e-06,-8.98101808940704e-07,-6.05921496377958e-06,-1.07514825178316e-05,-1.48747767068911e-05,-1.83425026421565e-05,-2.10838526034107e-05,-2.30456965810165e-05,-2.41940589077292e-05,-2.45151403706223e-05,-2.40158558402492e-05,-2.27238689524617e-05,-2.06871174583342e-05,-1.79728352322812e-05,-1.46660892999242e-05,-1.08678623142220e-05,-6.69272237326124e-06,-2.26613264916256e-06,2.27853728355407e-06,6.80322851399103e-06,1.11685619447835e-05,1.52372786005066e-05,1.88776674783312e-05,2.19668966469051e-05,2.43941646762272e-05,2.60635929041769e-05,2.68967844558920e-05,2.68349832228288e-05,2.58407750238791e-05,2.38992837123790e-05,2.10188268211363e-05,1.72310081792414e-05,1.25902384875479e-05,7.17268878122028e-06,1.07469570079208e-06,-5.58934880462374e-06,-1.26895776467190e-05,-2.00836408323932e-05,-2.76200411119294e-05,-3.51417350971218e-05,-4.24899144119392e-05,-4.95078759508003e-05,-5.60448869986753e-05,-6.19599499223487e-05,-6.71253724283833e-05,-7.14300529989233e-05,-7.47823970026089e-05,-7.71127870192349e-05,-7.83755409431866e-05,-7.85503032213125e-05,-7.76428278682144e-05,-7.56851263783141e-05,-7.27349689783656e-05,-6.88747434698519e-05,-6.42096918147497e-05,-5.88655602296993e-05,-5.29857134840943e-05,-4.67277779697827e-05,-4.02598905680835e-05,-3.37566410577332e-05,-2.73948044978733e-05,-2.13489664422975e-05,-1.57871478063821e-05,-1.08665375864010e-05,-6.72944035409715e-06,-3.49954151405113e-06,-1.27858677983188e-06,-1.43563324166156e-07,-1.44458778503445e-07,-1.30266094694503e-06,-3.61004606100560e-06,-7.02878698401201e-06,-1.14918953650297e-05,-1.69044937595358e-05,-2.31457956149697e-05,-3.00717532103963e-05,-3.75183165855122e-05,-4.53052306274798e-05,-5.32402832128251e-05,-6.11239050006150e-05,-6.87540114728464e-05,-7.59309703966529e-05,-8.24625732585381e-05,-8.81688875448486e-05,-9.28868680958025e-05,-9.64746101489657e-05,-9.88151340435860e-05,-9.98196017365313e-05,-9.94298780686560e-05,-9.76203648346973e-05,-9.43990528061280e-05,-8.98077555369700e-05,-8.39215086049126e-05,-7.68471384275215e-05,-6.87210254462656e-05,-5.97061067792639e-05,-4.99881828984717e-05,-3.97716109943299e-05,-2.92744839835164e-05,-1.87234081648331e-05,-8.34800395610535e-06,1.62473736689693e-06,1.09761027099842e-05,1.95011718230706e-05,2.70140589498153e-05,3.33527478108385e-05,3.83833946339623e-05,4.20039855331502e-05,4.41472491014699e-05,4.47827422997784e-05,4.39180471986475e-05,4.15990374119678e-05,3.79091956412773e-05,3.29679870858480e-05,2.69283169946762e-05,1.99731237602611e-05,1.23111811004810e-05,4.17220348022624e-06,-4.19863254351237e-06,-1.25466223987897e-05,-2.06137813650883e-05,-2.81452549708855e-05,-3.48957346761095e-05,-4.06357194377562e-05,-4.51574655379152e-05,-4.82804727774040e-05,-4.98563647138725e-05,-4.97730338622671e-05,-4.79579393957546e-05,-4.43804645168016e-05,-3.90532628613394e-05,-3.20325475345084e-05,-2.34173020774939e-05,-1.33474192105568e-05,-2.00079993763080e-06,1.04105281304094e-05,2.36451892334479e-05,3.74380273262927e-05,5.15063349741114e-05,6.55565968303312e-05,7.92915865888303e-05,9.24176454658422e-05,0.000104651963572482,0.000115729683205176,0.000125410645222791,0.000133485606299148,0.000139781765830072,0.000144167456417000,0.000146555870819928,0.000146907720647095,0.000145232747313117,0.000141590033358547,0.000136087091424411,0.000128877738308604,0.000120158791858081,0.000110165658218560,9.91669054233460e-05,8.74579457293283e-05,7.53539728174952e-05,6.31823203423773e-05,5.12744247907908e-05,3.99575877354478e-05,2.95467399873614e-05,2.03364126187959e-05,1.25931172223434e-05,6.54833009382184e-06,2.39226240478657e-06,2.68581117964074e-07,2.70223768994231e-07,2.43642477584272e-06,6.75104223037923e-06,1.31422428499930e-05,2.14835696685044e-05,3.15963829273027e-05,4.32536303273596e-05,5.61848691729715e-05,7.00824308252037e-05,8.46085881058978e-05,9.94035596224227e-05,0.000114094162121999,0.000128302903548459,0.000141657295977507,0.000153799159445388,0.000164393685128710,0.000173138029512202,0.000179769220086475,0.000184071167597477,0.000185880599629549,0.000185091754916560,0.000181659706685720,0.000175602215877656,0.000167000050487181,0.000155995744683852,0.000142790809891949,0.000127641448688862,0.000110852860257261,9.27722622459927e-05,7.37807873363478e-05,5.42844427086413e-05,3.47043461714582e-05,1.54664732637012e-05,-3.00883540427003e-06,-2.03173483788054e-05,-3.60811383683315e-05,-4.99582410982523e-05,-6.16515313970205e-05,-7.09165864688918e-05,-7.75683288080654e-05,-8.14862691427351e-05,-8.26182025340162e-05,-8.09822475343548e-05,-7.66671582639522e-05,-6.98308814334488e-05,-6.06973737018253e-05,-4.95517382433816e-05,-3.67337819248627e-05,-2.26301349919930e-05,-7.66511260124458e-06,7.70946906092157e-06,2.30252808326537e-05,3.78090087463815e-05,5.15941417463744e-05,6.39327286743555e-05,7.44068116470312e-05,8.26392476169866e-05,8.83036418067135e-05,9.11331356221120e-05,9.09278171957678e-05,8.75605543215488e-05,8.09810865026578e-05,7.12182542856590e-05,5.83802890118547e-05,4.26531335047461e-05,2.42968128752471e-05,3.63992336698821e-06,-1.89276452309478e-05,-4.29635928061826e-05,-6.79834952010890e-05,-9.34722537558137e-05,-0.000118896436662034,-0.000143717215409502,-0.000167403581445830,-0.000189445517642528,-0.000209366796615419,-0.000226737083539167,-0.000241183034774961,-0.000252398105148543,-0.000260150805624053,-0.000264291188780519,-0.000264755381099698,-0.000261568027646268,-0.000254842565159846,-0.000244779292669518,-0.000231661263192979,-0.000215848074552636,-0.000197767690474055,-0.000177906473589419,-0.000156797658464231,-0.000135008534097439,-0.000113126640427012,-9.17453112623285e-05,-7.14489159875354e-05,-5.27981637525678e-05,-3.63158363137392e-05,-2.24733090443995e-05,-1.16782039745075e-05,-4.26349432652567e-06,-4.78347406348867e-07,-4.80952603891298e-07,-4.33353457519514e-06,-1.19996995074985e-05,-2.33442059494538e-05,-3.81351923795109e-05,-5.60488329313325e-05,-7.66763319932318e-05,-9.95331092605151e-05,-0.000124069970734756,-0.000149686009561508,-0.000175742934810692,-0.000201580487534684,-0.000226532572728117,-0.000249943714012211,-0.000271185425613046,-0.000289672093904992,-0.000304875968611539,-0.000316340881609286,-0.000323694338829785,-0.000326657667415978,-0.000325053945249744,-0.000318813492193812,-0.000307976760662456,-0.000292694526064859,-0.000273225343736049,-0.000249930306571868,-0.000223265205050276,-0.000193770256971247,-0.000162057636428417,-0.000128797088653835,-9.46999679778587e-05,-6.05020788913360e-05,-2.69457339411997e-05,5.23853400107588e-06,3.53501543824140e-05,6.27361437012181e-05,8.68077286432531e-05,0.000107055544195889,0.000123063014320286,0.000134517563846794,0.000141219360508632,0.000143087344288257,0.000140162366153148,0.000132607328257499,0.000120704291094923,0.000104848588113787,8.55400631016614e-05,6.33716183457530e-05,3.90153303519196e-05,1.32064530051691e-05,-1.32743161488381e-05,-3.96198837913428e-05,-6.50166631726510e-05,-8.86648452392469e-05,-0.000109798538728470,-0.000127705277545933,-0.000141744404325868,-0.000151363861975072,-0.000156114959773858,-0.000155664726508158,-0.000149805519107234,-0.000138461620071730,-0.000121692629074504,-9.96935317830412e-05,-7.27914103124588e-05,-4.14388427864570e-05,-6.20412221200422e-06,3.22414947984447e-05,7.31392230169623e-05,0.000115660511309177,0.000158926715662653,0.000202030213483484,0.000244056449595285,0.000284106376116139,0.000321318733211093,0.000354891616129230,0.000384102786110034,0.000408328208518571,0.000427058340438026,0.000439911741075213,0.000446645640571440,0.000447163174720774,0.000441517072989073,0.000429909673193855,0.000412689226170547,0.000390342545518687,0.000363484148829394,0.000332842125369025,0.000299241048805519,0.000263582330086276,0.000226822473038745,0.000189949751900977,0.000153959874285921,0.000119831223818234,8.85002929588031e-05,6.08379178044246e-05,3.76269127391283e-05,1.95416739168653e-05,7.13027724422380e-06,7.99539741688663e-07,8.03444172258673e-07,7.23524723211749e-06,2.00235032736089e-05,3.89321405853290e-05,6.35646279820385e-05,9.33721682824040e-05,0.000127665754670175,0.000165631828448348,0.000206351184758056,0.000248820688781271,0.000291977290943007,0.000334723767610093,0.000375955565404854,0.000414588093847094,0.000449583793580076,0.000479978306512457,0.000504905090000751,0.000523617849473795,0.000535510212018402,0.000540132126361256,0.000537202550974842,0.000526618079938901,0.000508457253631285,0.000482980405974909,0.000450625009300998,0.000411996589232705,0.000367855392602167,0.000319099098534904,0.000266741963775037,0.000211890885518809,0.000155718946099831,9.94370717093532e-05,4.42644901290688e-05,-8.60129125104710e-06,-5.80142471183028e-05,-0.000102908595062878,-0.000142325832801589,-0.000175439364982867,-0.000201576086064396,-0.000220234355286806,-0.000231097883949312,-0.000234045152074911,-0.000229154078848268,-0.000216701786353664,-0.000197159416349247,-0.000171182082151582,-0.000139594159154690,-0.000103370235048135,-6.36121514758324e-05,-2.15226698799736e-05,2.16236169938312e-05,6.45114323101559e-05,0.000105817267875577,0.000144242349755163,0.000178545304001299,0.000207573709558302,0.000230293745406171,0.000245817178862215,0.000253425000866444,0.000252587090750343,0.000242977385692312,0.000224484136645149,0.000197214950466085,0.000161496444467526,0.000117868471577890,6.70730085339768e-05,1.00379327099976e-05,-5.21439579894535e-05,-0.000118240206520217,-0.000186907653170673,-0.000256724403876856,-0.000326224046153305,-0.000393931285626180,-0.000458398133296654,-0.000518239751978772,-0.000572169070578353,-0.000619029297205024,-0.000657823506186881,-0.000687740538993402,-0.000708176543448306,-0.000718751577515987,-0.000719320821006559,-0.000709980068001800,-0.000691065311560716,-0.000663146376963658,-0.000627014706864413,-0.000583665547614952,-0.000534274927079298,-0.000480171946919539,-0.000422807033252986,-0.000363716895639936,-0.000304487032800738,-0.000246712691927115,-0.000191959235065461,-0.000141722889454869,-9.73928581091491e-05,-6.02157421352577e-05,-3.12631776758348e-05,-1.14035189389592e-05,-1.27830609644912e-06,-1.28414499787228e-06,-1.15604972581545e-05,-3.19837373646562e-05,-6.21676814090968e-05,-0.000101470633557035,-0.000149008835292300,-0.000203676042784286,-0.000264168803392040,-0.000329016857214340,-0.000396617957397887,-0.000465276287019932,-0.000533243553785853,-0.000598761769093957,-0.000660106667268488,-0.000715630695420159,-0.000763804505319571,-0.000803255906077186,-0.000832805289873032,-0.000851496621381990,-0.000858623183178534,-0.000853747391969599,-0.000836714141148757,-0.000807657280567424,-0.000766999010863056,-0.000715442143146501,-0.000653955351097443,-0.000583751717207428,-0.000506261043703395,-0.000423096557347087,-0.000336016781816214,-0.000246883478025130,-0.000157616658238789,-7.01477613711472e-05,1.36278677977211e-05,9.18980252073380e-05,0.000162979050815063,0.000225358449664866,0.000277733650406843,0.000319045906848680,0.000348508459416795,0.000365628207570305,0.000370220298127984,0.000362415204503383,0.000342658053931345,0.000311700149509774,0.000270582826645274,0.000220613974534344,0.000163337737888764,0.000100498087596727,3.39971070062460e-05,-3.41510210257217e-05,-0.000101869225859289,-0.000167068770000171,-0.000227701229189070,-0.000281809951538356,-0.000327579716945190,-0.000363383351016169,-0.000387824111874706,-0.000399772762180807,-0.000398398360415892,-0.000383191952209301,-0.000353982510801921,-0.000310944661683732,-0.000254597925563577,-0.000185797421321440,-0.000105716181397427,-1.58194410004577e-05,8.21685356122349e-05,0.000186304338785075,0.000294471081217660,0.000404428772520432,0.000513868197084836,0.000620466994233419,0.000721946573376533,0.000816128463893200,0.000900988700787972,0.000974708883129717,0.00103572261227393,0.00108275611948121,0.00111486202552758,0.00113144533523988,0.00113228095386303,0.00111752221543765,0.00108770013108261,0.00104371329198379,0.000986808592458666,0.000918553167027713,0.000840798156307415,0.000755635124215944,0.000665346138195748,0.000572348690063218,0.000479136773381860,0.000388219540253419,0.000302059033203886,0.000223008524299527,0.000153252992532919,9.47532315581945e-05,4.91950036490237e-05,1.79445438497406e-05,2.01157313223564e-06,2.02080424637632e-06,1.81927229168137e-05,5.03342048285106e-05,9.78392907574999e-05,0.000159700193982425,0.000234528361799244,0.000320585162754205,0.000415821529311516,0.000517925658134754,0.000624377662738522,0.000732509891267320,0.000839571470309758,0.000942795517985738,0.00103946738926881,0.00112699227595116,0.00120296048418767,0.00126520875453000,0.00131187607212363,0.00134145253661706,0.00135282001967087,0.00134528352917674,0.00131859241898056,0.00127295082588366,0.00120901697618515,0.00112789127575182,0.00103109337395438,0.000920528666006238,0.000798444963493540,0.000667380312559971,0.000530103166999160,0.000389546323584335,0.000248736194135167,0.000110719118653399,-2.15134871967786e-05,-0.000145099311504840,-0.000257376813170649,-0.000355952582262633,-0.000438762688980735,-0.000504126449097190,-0.000550791206370916,-0.000577966941218078,-0.000585349755055451,-0.000573133545578903,-0.000542009473475847,-0.000493153118838928,-0.000428199528618103,-0.000349206657389807,-0.000258607995090906,-0.000159155449881650,-5.38538050366319e-05,5.41117106939560e-05,0.000161453015181850,0.000264860059584202,0.000361083042596103,0.000447013933833857,0.000519765285729716,0.000576744360997401,0.000615720699538947,0.000634885392685157,0.000632900520788221,0.000608937438194730,0.000562702852276161,0.000494451934334234,0.000404988012923284,0.000295648726935574,0.000168278848756357,2.51903187632194e-05,-0.000130889646757849,-0.000296881209584909,-0.000469423883911376,-0.000644956145629967,-0.000819800786371812,-0.000990253962019241,-0.00115267577430911,-0.00130358016525393,-0.00143972189938485,-0.00155817845890397,-0.00165642478101906,-0.00173239892297940,-0.00178455694529284,-0.00181191555270568,-0.00181408132006245,-0.00179126564942408,-0.00174428494825755,-0.00167454587789500,-0.00158401588810352,-0.00147517961854838,-0.00135098210217293,-0.00121476004022828,-0.00107016272543361,-0.000921064460706439,-0.000771470549047010,-0.000625419109453847,-0.000486881099290197,-0.000359660991691404,-0.000247300565152518,-0.000152988210558844,-7.94760492948567e-05,-2.90069868367392e-05,-3.25360298880473e-06,-3.27050761398161e-06,-2.94614755394413e-05,-8.15623236114081e-05,-0.000158640114895673,-0.000259108878793139,-0.000380761630922133,-0.000520818072880335,-0.000675986959378078,-0.000842541748498463,-0.00101640780933915,-0.00119325915873078,-0.00136862244294325,-0.00153798567804920,-0.00169690911943657,-0.00184113555097384,-0.00196669727015117,-0.00207001709817716,-0.00214800086290163,-0.00219811898532894,-0.00221847504355503,-0.00220785948586243,-0.00216578701069893,-0.00209251651735110,-0.00198905294824731,-0.00185713078206827,-0.00169917938567170,-0.00151827088134408,-0.00131805162306539,-0.00110265879046125,-0.000876623991501071,-0.000644766105050792,-0.000412075883306929,-0.000183595064291421,3.57070903047417e-05,0.000241056821325182,0.000427995429362594,0.000592492381737633,0.000731049113541486,0.000840790864067476,0.000919544154411490,0.000965897838157794,0.000979246037568577,0.000959811703833302,0.000908650001769358,0.000827631205975991,0.000719403295183500,0.000587334932313086,0.000435440007317350,0.000268285386092592,9.08839399667716e-05,-9.14246844791461e-05,-0.000273102766151067,-0.000448549626885884,-0.000612239918798687,-0.000758861719128629,-0.000883451035625306,-0.000981519373782903,-0.00104917114807955,-0.00108320793056344,-0.00108121681740395,-0.00104164055125145,-0.000963827456501183,-0.000848059716307832,-0.000695559033532114,-0.000508469260663421,-0.000289816143237681,-4.34448838883590e-05,0.000226063213770609,0.000513493234331800,0.000813115995188593,0.00111882152806038,0.00142426359926229,0.00172301186191964,0.00200870800419485,0.00227522211448903,0.00251680543202987,0.00272823569164466,0.00290495140498654,0.00304317164491974,0.00313999821082169,0.00319349744371464,0.00320275942285973,0.00316793279935148,0.00309023409534734,0.00297193090652055,0.00281629907576742,0.00262755454306333,0.00241076120423993,0.00217171671496572,0.00191681874037436,0.00165291466138779,0.00138713819273054,0.00112673673329178,0.000878893546969582,0.000650549053553742,0.000448225588916055,0.000277859968522380,0.000144648057296917,5.29053139444758e-05,5.94694329620738e-06,5.99086287770732e-06,5.40861788272047e-05,0.000150069282778231,0.000292549038524897,0.000478921839971698,0.000705416606064428,0.000967169051034619,0.00125832384679857,0.00157216259625542,0.00190125487871855,0.00223762902823166,0.00257295877735756,0.00289876145693493,0.00320660309814734,0.00348830554671064,0.00373615057727799,0.00394307599384118,0.00410285882072249,0.00421028092756830,0.00426127278654222,0.00425303152380279,0.00418410999075722,0.00405447423140808,0.00386552744598960,0.00362009933170846,0.00332240050085812,0.00297794251577616,0.00259342491923390,0.00217659145777208,0.00173605847430913,0.00128111916580298,0.000821528043732494,0.000367270483157183,-7.16773144136455e-05,-0.000485592300312833,-0.000865246667476731,-0.00120214216396474,-0.00148873083450417,-0.00171861662138562,-0.00188673262092930,-0.00198948928694073,-0.00202488948835477,-0.00199260705190847,-0.00189402623672046,-0.00173224047820440,-0.00151200968389131,-0.00123967634197237,-0.000923041692086139,-0.000571204183850102,-0.000194363388611549,0.000196406588911171,0.000589409351759847,0.000972598557359174,0.00133386424127802,0.00166132654321777,0.00194362996101052,0.00217023111585182,0.00233167303216172,0.00241983912064171,0.00242818040173730,0.00235191001346110,0.00218815970324680,0.00193609379545453,0.00159697703822804,0.00117419374647071,0.000673216749970102,0.000101525803191957,-0.000531523709644881,-0.00121487976063155,-0.00193601718615589,-0.00268120144339329,-0.00343578731544735,-0.00418454634160310,-0.00491201595124823,-0.00560286262840364,-0.00624225094598046,-0.00681620999888991,-0.00731198864318559,-0.00771839102061050,-0.00802608411603497,-0.00822786955666816,-0.00831891250954849,-0.00829692135628479,-0.00816227280581824,-0.00791807822775797,-0.00757018822780625,-0.00712713381713782,-0.00660000392108669,-0.00600226039902108,-0.00534949317555186,-0.00465911948139912,-0.00395003253869633,-0.00324220626950047,-0.00255626372864382,-0.00191301793591757,-0.00133299458391500,-0.000835946706137723,-0.000440371788596579,-0.000163041984913172,-1.85580423424644e-05,-1.89372616174212e-05,-0.000173245299533285,-0.000487280887269239,-0.000963321592066354,-0.00159993761225935,-0.00239187928742932,-0.00333004255223517,-0.00440151499340514,-0.00558970351642856,-0.00687454292590401,-0.00823278300700239,-0.00963835000156369,-0.0110627767373953,-0.0124756941289840,-0.0138453753560656,-0.0151393227749555,-0.0163248865547994,-0.0173699031818188,-0.0182433413597792,-0.0189159424701110,-0.0193608426510416,-0.0195541637169805,-0.0194755605669156,-0.0191087134177581,-0.0184417541339143,-0.0174676170910276,-0.0161843063879460,-0.0145950727800812,-0.0127084954188836,-0.0105384653122129,-0.00810406933218672,-0.00542937555194152,-0.00254312265074136,0.000521681952213190,0.00372824873082405,0.00703656921862434,0.0104040458979415,0.0137861776080196,0.0171372880898983,0.0204112843469171,0.0235624308208553,0.0265461249800828,0.0293196597972102,0.0318429587632528,0.0340792695409686,0.0359958030935775,0.0375643061225328,0.0387615558899336,0.0395697679629598,0.0399769090702459,0.0399769090702459,0.0395697679629598,0.0387615558899336,0.0375643061225328,0.0359958030935775,0.0340792695409686,0.0318429587632528,0.0293196597972102,0.0265461249800828,0.0235624308208553,0.0204112843469171,0.0171372880898983,0.0137861776080196,0.0104040458979415,0.00703656921862434,0.00372824873082405,0.000521681952213190,-0.00254312265074136,-0.00542937555194152,-0.00810406933218672,-0.0105384653122129,-0.0127084954188836,-0.0145950727800812,-0.0161843063879460,-0.0174676170910276,-0.0184417541339143,-0.0191087134177581,-0.0194755605669156,-0.0195541637169805,-0.0193608426510416,-0.0189159424701110,-0.0182433413597792,-0.0173699031818188,-0.0163248865547994,-0.0151393227749555,-0.0138453753560656,-0.0124756941289840,-0.0110627767373953,-0.00963835000156369,-0.00823278300700239,-0.00687454292590401,-0.00558970351642856,-0.00440151499340514,-0.00333004255223517,-0.00239187928742932,-0.00159993761225935,-0.000963321592066354,-0.000487280887269239,-0.000173245299533285,-1.89372616174212e-05,-1.85580423424644e-05,-0.000163041984913172,-0.000440371788596579,-0.000835946706137723,-0.00133299458391500,-0.00191301793591757,-0.00255626372864382,-0.00324220626950047,-0.00395003253869633,-0.00465911948139912,-0.00534949317555186,-0.00600226039902108,-0.00660000392108669,-0.00712713381713782,-0.00757018822780625,-0.00791807822775797,-0.00816227280581824,-0.00829692135628479,-0.00831891250954849,-0.00822786955666816,-0.00802608411603497,-0.00771839102061050,-0.00731198864318559,-0.00681620999888991,-0.00624225094598046,-0.00560286262840364,-0.00491201595124823,-0.00418454634160310,-0.00343578731544735,-0.00268120144339329,-0.00193601718615589,-0.00121487976063155,-0.000531523709644881,0.000101525803191957,0.000673216749970102,0.00117419374647071,0.00159697703822804,0.00193609379545453,0.00218815970324680,0.00235191001346110,0.00242818040173730,0.00241983912064171,0.00233167303216172,0.00217023111585182,0.00194362996101052,0.00166132654321777,0.00133386424127802,0.000972598557359174,0.000589409351759847,0.000196406588911171,-0.000194363388611549,-0.000571204183850102,-0.000923041692086139,-0.00123967634197237,-0.00151200968389131,-0.00173224047820440,-0.00189402623672046,-0.00199260705190847,-0.00202488948835477,-0.00198948928694073,-0.00188673262092930,-0.00171861662138562,-0.00148873083450417,-0.00120214216396474,-0.000865246667476731,-0.000485592300312833,-7.16773144136455e-05,0.000367270483157183,0.000821528043732494,0.00128111916580298,0.00173605847430913,0.00217659145777208,0.00259342491923390,0.00297794251577616,0.00332240050085812,0.00362009933170846,0.00386552744598960,0.00405447423140808,0.00418410999075722,0.00425303152380279,0.00426127278654222,0.00421028092756830,0.00410285882072249,0.00394307599384118,0.00373615057727799,0.00348830554671064,0.00320660309814734,0.00289876145693493,0.00257295877735756,0.00223762902823166,0.00190125487871855,0.00157216259625542,0.00125832384679857,0.000967169051034619,0.000705416606064428,0.000478921839971698,0.000292549038524897,0.000150069282778231,5.40861788272047e-05,5.99086287770732e-06,5.94694329620738e-06,5.29053139444758e-05,0.000144648057296917,0.000277859968522380,0.000448225588916055,0.000650549053553742,0.000878893546969582,0.00112673673329178,0.00138713819273054,0.00165291466138779,0.00191681874037436,0.00217171671496572,0.00241076120423993,0.00262755454306333,0.00281629907576742,0.00297193090652055,0.00309023409534734,0.00316793279935148,0.00320275942285973,0.00319349744371464,0.00313999821082169,0.00304317164491974,0.00290495140498654,0.00272823569164466,0.00251680543202987,0.00227522211448903,0.00200870800419485,0.00172301186191964,0.00142426359926229,0.00111882152806038,0.000813115995188593,0.000513493234331800,0.000226063213770609,-4.34448838883590e-05,-0.000289816143237681,-0.000508469260663421,-0.000695559033532114,-0.000848059716307832,-0.000963827456501183,-0.00104164055125145,-0.00108121681740395,-0.00108320793056344,-0.00104917114807955,-0.000981519373782903,-0.000883451035625306,-0.000758861719128629,-0.000612239918798687,-0.000448549626885884,-0.000273102766151067,-9.14246844791461e-05,9.08839399667716e-05,0.000268285386092592,0.000435440007317350,0.000587334932313086,0.000719403295183500,0.000827631205975991,0.000908650001769358,0.000959811703833302,0.000979246037568577,0.000965897838157794,0.000919544154411490,0.000840790864067476,0.000731049113541486,0.000592492381737633,0.000427995429362594,0.000241056821325182,3.57070903047417e-05,-0.000183595064291421,-0.000412075883306929,-0.000644766105050792,-0.000876623991501071,-0.00110265879046125,-0.00131805162306539,-0.00151827088134408,-0.00169917938567170,-0.00185713078206827,-0.00198905294824731,-0.00209251651735110,-0.00216578701069893,-0.00220785948586243,-0.00221847504355503,-0.00219811898532894,-0.00214800086290163,-0.00207001709817716,-0.00196669727015117,-0.00184113555097384,-0.00169690911943657,-0.00153798567804920,-0.00136862244294325,-0.00119325915873078,-0.00101640780933915,-0.000842541748498463,-0.000675986959378078,-0.000520818072880335,-0.000380761630922133,-0.000259108878793139,-0.000158640114895673,-8.15623236114081e-05,-2.94614755394413e-05,-3.27050761398161e-06,-3.25360298880473e-06,-2.90069868367392e-05,-7.94760492948567e-05,-0.000152988210558844,-0.000247300565152518,-0.000359660991691404,-0.000486881099290197,-0.000625419109453847,-0.000771470549047010,-0.000921064460706439,-0.00107016272543361,-0.00121476004022828,-0.00135098210217293,-0.00147517961854838,-0.00158401588810352,-0.00167454587789500,-0.00174428494825755,-0.00179126564942408,-0.00181408132006245,-0.00181191555270568,-0.00178455694529284,-0.00173239892297940,-0.00165642478101906,-0.00155817845890397,-0.00143972189938485,-0.00130358016525393,-0.00115267577430911,-0.000990253962019241,-0.000819800786371812,-0.000644956145629967,-0.000469423883911376,-0.000296881209584909,-0.000130889646757849,2.51903187632194e-05,0.000168278848756357,0.000295648726935574,0.000404988012923284,0.000494451934334234,0.000562702852276161,0.000608937438194730,0.000632900520788221,0.000634885392685157,0.000615720699538947,0.000576744360997401,0.000519765285729716,0.000447013933833857,0.000361083042596103,0.000264860059584202,0.000161453015181850,5.41117106939560e-05,-5.38538050366319e-05,-0.000159155449881650,-0.000258607995090906,-0.000349206657389807,-0.000428199528618103,-0.000493153118838928,-0.000542009473475847,-0.000573133545578903,-0.000585349755055451,-0.000577966941218078,-0.000550791206370916,-0.000504126449097190,-0.000438762688980735,-0.000355952582262633,-0.000257376813170649,-0.000145099311504840,-2.15134871967786e-05,0.000110719118653399,0.000248736194135167,0.000389546323584335,0.000530103166999160,0.000667380312559971,0.000798444963493540,0.000920528666006238,0.00103109337395438,0.00112789127575182,0.00120901697618515,0.00127295082588366,0.00131859241898056,0.00134528352917674,0.00135282001967087,0.00134145253661706,0.00131187607212363,0.00126520875453000,0.00120296048418767,0.00112699227595116,0.00103946738926881,0.000942795517985738,0.000839571470309758,0.000732509891267320,0.000624377662738522,0.000517925658134754,0.000415821529311516,0.000320585162754205,0.000234528361799244,0.000159700193982425,9.78392907574999e-05,5.03342048285106e-05,1.81927229168137e-05,2.02080424637632e-06,2.01157313223564e-06,1.79445438497406e-05,4.91950036490237e-05,9.47532315581945e-05,0.000153252992532919,0.000223008524299527,0.000302059033203886,0.000388219540253419,0.000479136773381860,0.000572348690063218,0.000665346138195748,0.000755635124215944,0.000840798156307415,0.000918553167027713,0.000986808592458666,0.00104371329198379,0.00108770013108261,0.00111752221543765,0.00113228095386303,0.00113144533523988,0.00111486202552758,0.00108275611948121,0.00103572261227393,0.000974708883129717,0.000900988700787972,0.000816128463893200,0.000721946573376533,0.000620466994233419,0.000513868197084836,0.000404428772520432,0.000294471081217660,0.000186304338785075,8.21685356122349e-05,-1.58194410004577e-05,-0.000105716181397427,-0.000185797421321440,-0.000254597925563577,-0.000310944661683732,-0.000353982510801921,-0.000383191952209301,-0.000398398360415892,-0.000399772762180807,-0.000387824111874706,-0.000363383351016169,-0.000327579716945190,-0.000281809951538356,-0.000227701229189070,-0.000167068770000171,-0.000101869225859289,-3.41510210257217e-05,3.39971070062460e-05,0.000100498087596727,0.000163337737888764,0.000220613974534344,0.000270582826645274,0.000311700149509774,0.000342658053931345,0.000362415204503383,0.000370220298127984,0.000365628207570305,0.000348508459416795,0.000319045906848680,0.000277733650406843,0.000225358449664866,0.000162979050815063,9.18980252073380e-05,1.36278677977211e-05,-7.01477613711472e-05,-0.000157616658238789,-0.000246883478025130,-0.000336016781816214,-0.000423096557347087,-0.000506261043703395,-0.000583751717207428,-0.000653955351097443,-0.000715442143146501,-0.000766999010863056,-0.000807657280567424,-0.000836714141148757,-0.000853747391969599,-0.000858623183178534,-0.000851496621381990,-0.000832805289873032,-0.000803255906077186,-0.000763804505319571,-0.000715630695420159,-0.000660106667268488,-0.000598761769093957,-0.000533243553785853,-0.000465276287019932,-0.000396617957397887,-0.000329016857214340,-0.000264168803392040,-0.000203676042784286,-0.000149008835292300,-0.000101470633557035,-6.21676814090968e-05,-3.19837373646562e-05,-1.15604972581545e-05,-1.28414499787228e-06,-1.27830609644912e-06,-1.14035189389592e-05,-3.12631776758348e-05,-6.02157421352577e-05,-9.73928581091491e-05,-0.000141722889454869,-0.000191959235065461,-0.000246712691927115,-0.000304487032800738,-0.000363716895639936,-0.000422807033252986,-0.000480171946919539,-0.000534274927079298,-0.000583665547614952,-0.000627014706864413,-0.000663146376963658,-0.000691065311560716,-0.000709980068001800,-0.000719320821006559,-0.000718751577515987,-0.000708176543448306,-0.000687740538993402,-0.000657823506186881,-0.000619029297205024,-0.000572169070578353,-0.000518239751978772,-0.000458398133296654,-0.000393931285626180,-0.000326224046153305,-0.000256724403876856,-0.000186907653170673,-0.000118240206520217,-5.21439579894535e-05,1.00379327099976e-05,6.70730085339768e-05,0.000117868471577890,0.000161496444467526,0.000197214950466085,0.000224484136645149,0.000242977385692312,0.000252587090750343,0.000253425000866444,0.000245817178862215,0.000230293745406171,0.000207573709558302,0.000178545304001299,0.000144242349755163,0.000105817267875577,6.45114323101559e-05,2.16236169938312e-05,-2.15226698799736e-05,-6.36121514758324e-05,-0.000103370235048135,-0.000139594159154690,-0.000171182082151582,-0.000197159416349247,-0.000216701786353664,-0.000229154078848268,-0.000234045152074911,-0.000231097883949312,-0.000220234355286806,-0.000201576086064396,-0.000175439364982867,-0.000142325832801589,-0.000102908595062878,-5.80142471183028e-05,-8.60129125104710e-06,4.42644901290688e-05,9.94370717093532e-05,0.000155718946099831,0.000211890885518809,0.000266741963775037,0.000319099098534904,0.000367855392602167,0.000411996589232705,0.000450625009300998,0.000482980405974909,0.000508457253631285,0.000526618079938901,0.000537202550974842,0.000540132126361256,0.000535510212018402,0.000523617849473795,0.000504905090000751,0.000479978306512457,0.000449583793580076,0.000414588093847094,0.000375955565404854,0.000334723767610093,0.000291977290943007,0.000248820688781271,0.000206351184758056,0.000165631828448348,0.000127665754670175,9.33721682824040e-05,6.35646279820385e-05,3.89321405853290e-05,2.00235032736089e-05,7.23524723211749e-06,8.03444172258673e-07,7.99539741688663e-07,7.13027724422380e-06,1.95416739168653e-05,3.76269127391283e-05,6.08379178044246e-05,8.85002929588031e-05,0.000119831223818234,0.000153959874285921,0.000189949751900977,0.000226822473038745,0.000263582330086276,0.000299241048805519,0.000332842125369025,0.000363484148829394,0.000390342545518687,0.000412689226170547,0.000429909673193855,0.000441517072989073,0.000447163174720774,0.000446645640571440,0.000439911741075213,0.000427058340438026,0.000408328208518571,0.000384102786110034,0.000354891616129230,0.000321318733211093,0.000284106376116139,0.000244056449595285,0.000202030213483484,0.000158926715662653,0.000115660511309177,7.31392230169623e-05,3.22414947984447e-05,-6.20412221200422e-06,-4.14388427864570e-05,-7.27914103124588e-05,-9.96935317830412e-05,-0.000121692629074504,-0.000138461620071730,-0.000149805519107234,-0.000155664726508158,-0.000156114959773858,-0.000151363861975072,-0.000141744404325868,-0.000127705277545933,-0.000109798538728470,-8.86648452392469e-05,-6.50166631726510e-05,-3.96198837913428e-05,-1.32743161488381e-05,1.32064530051691e-05,3.90153303519196e-05,6.33716183457530e-05,8.55400631016614e-05,0.000104848588113787,0.000120704291094923,0.000132607328257499,0.000140162366153148,0.000143087344288257,0.000141219360508632,0.000134517563846794,0.000123063014320286,0.000107055544195889,8.68077286432531e-05,6.27361437012181e-05,3.53501543824140e-05,5.23853400107588e-06,-2.69457339411997e-05,-6.05020788913360e-05,-9.46999679778587e-05,-0.000128797088653835,-0.000162057636428417,-0.000193770256971247,-0.000223265205050276,-0.000249930306571868,-0.000273225343736049,-0.000292694526064859,-0.000307976760662456,-0.000318813492193812,-0.000325053945249744,-0.000326657667415978,-0.000323694338829785,-0.000316340881609286,-0.000304875968611539,-0.000289672093904992,-0.000271185425613046,-0.000249943714012211,-0.000226532572728117,-0.000201580487534684,-0.000175742934810692,-0.000149686009561508,-0.000124069970734756,-9.95331092605151e-05,-7.66763319932318e-05,-5.60488329313325e-05,-3.81351923795109e-05,-2.33442059494538e-05,-1.19996995074985e-05,-4.33353457519514e-06,-4.80952603891298e-07,-4.78347406348867e-07,-4.26349432652567e-06,-1.16782039745075e-05,-2.24733090443995e-05,-3.63158363137392e-05,-5.27981637525678e-05,-7.14489159875354e-05,-9.17453112623285e-05,-0.000113126640427012,-0.000135008534097439,-0.000156797658464231,-0.000177906473589419,-0.000197767690474055,-0.000215848074552636,-0.000231661263192979,-0.000244779292669518,-0.000254842565159846,-0.000261568027646268,-0.000264755381099698,-0.000264291188780519,-0.000260150805624053,-0.000252398105148543,-0.000241183034774961,-0.000226737083539167,-0.000209366796615419,-0.000189445517642528,-0.000167403581445830,-0.000143717215409502,-0.000118896436662034,-9.34722537558137e-05,-6.79834952010890e-05,-4.29635928061826e-05,-1.89276452309478e-05,3.63992336698821e-06,2.42968128752471e-05,4.26531335047461e-05,5.83802890118547e-05,7.12182542856590e-05,8.09810865026578e-05,8.75605543215488e-05,9.09278171957678e-05,9.11331356221120e-05,8.83036418067135e-05,8.26392476169866e-05,7.44068116470312e-05,6.39327286743555e-05,5.15941417463744e-05,3.78090087463815e-05,2.30252808326537e-05,7.70946906092157e-06,-7.66511260124458e-06,-2.26301349919930e-05,-3.67337819248627e-05,-4.95517382433816e-05,-6.06973737018253e-05,-6.98308814334488e-05,-7.66671582639522e-05,-8.09822475343548e-05,-8.26182025340162e-05,-8.14862691427351e-05,-7.75683288080654e-05,-7.09165864688918e-05,-6.16515313970205e-05,-4.99582410982523e-05,-3.60811383683315e-05,-2.03173483788054e-05,-3.00883540427003e-06,1.54664732637012e-05,3.47043461714582e-05,5.42844427086413e-05,7.37807873363478e-05,9.27722622459927e-05,0.000110852860257261,0.000127641448688862,0.000142790809891949,0.000155995744683852,0.000167000050487181,0.000175602215877656,0.000181659706685720,0.000185091754916560,0.000185880599629549,0.000184071167597477,0.000179769220086475,0.000173138029512202,0.000164393685128710,0.000153799159445388,0.000141657295977507,0.000128302903548459,0.000114094162121999,9.94035596224227e-05,8.46085881058978e-05,7.00824308252037e-05,5.61848691729715e-05,4.32536303273596e-05,3.15963829273027e-05,2.14835696685044e-05,1.31422428499930e-05,6.75104223037923e-06,2.43642477584272e-06,2.70223768994231e-07,2.68581117964074e-07,2.39226240478657e-06,6.54833009382184e-06,1.25931172223434e-05,2.03364126187959e-05,2.95467399873614e-05,3.99575877354478e-05,5.12744247907908e-05,6.31823203423773e-05,7.53539728174952e-05,8.74579457293283e-05,9.91669054233460e-05,0.000110165658218560,0.000120158791858081,0.000128877738308604,0.000136087091424411,0.000141590033358547,0.000145232747313117,0.000146907720647095,0.000146555870819928,0.000144167456417000,0.000139781765830072,0.000133485606299148,0.000125410645222791,0.000115729683205176,0.000104651963572482,9.24176454658422e-05,7.92915865888303e-05,6.55565968303312e-05,5.15063349741114e-05,3.74380273262927e-05,2.36451892334479e-05,1.04105281304094e-05,-2.00079993763080e-06,-1.33474192105568e-05,-2.34173020774939e-05,-3.20325475345084e-05,-3.90532628613394e-05,-4.43804645168016e-05,-4.79579393957546e-05,-4.97730338622671e-05,-4.98563647138725e-05,-4.82804727774040e-05,-4.51574655379152e-05,-4.06357194377562e-05,-3.48957346761095e-05,-2.81452549708855e-05,-2.06137813650883e-05,-1.25466223987897e-05,-4.19863254351237e-06,4.17220348022624e-06,1.23111811004810e-05,1.99731237602611e-05,2.69283169946762e-05,3.29679870858480e-05,3.79091956412773e-05,4.15990374119678e-05,4.39180471986475e-05,4.47827422997784e-05,4.41472491014699e-05,4.20039855331502e-05,3.83833946339623e-05,3.33527478108385e-05,2.70140589498153e-05,1.95011718230706e-05,1.09761027099842e-05,1.62473736689693e-06,-8.34800395610535e-06,-1.87234081648331e-05,-2.92744839835164e-05,-3.97716109943299e-05,-4.99881828984717e-05,-5.97061067792639e-05,-6.87210254462656e-05,-7.68471384275215e-05,-8.39215086049126e-05,-8.98077555369700e-05,-9.43990528061280e-05,-9.76203648346973e-05,-9.94298780686560e-05,-9.98196017365313e-05,-9.88151340435860e-05,-9.64746101489657e-05,-9.28868680958025e-05,-8.81688875448486e-05,-8.24625732585381e-05,-7.59309703966529e-05,-6.87540114728464e-05,-6.11239050006150e-05,-5.32402832128251e-05,-4.53052306274798e-05,-3.75183165855122e-05,-3.00717532103963e-05,-2.31457956149697e-05,-1.69044937595358e-05,-1.14918953650297e-05,-7.02878698401201e-06,-3.61004606100560e-06,-1.30266094694503e-06,-1.44458778503445e-07,-1.43563324166156e-07,-1.27858677983188e-06,-3.49954151405113e-06,-6.72944035409715e-06,-1.08665375864010e-05,-1.57871478063821e-05,-2.13489664422975e-05,-2.73948044978733e-05,-3.37566410577332e-05,-4.02598905680835e-05,-4.67277779697827e-05,-5.29857134840943e-05,-5.88655602296993e-05,-6.42096918147497e-05,-6.88747434698519e-05,-7.27349689783656e-05,-7.56851263783141e-05,-7.76428278682144e-05,-7.85503032213125e-05,-7.83755409431866e-05,-7.71127870192349e-05,-7.47823970026089e-05,-7.14300529989233e-05,-6.71253724283833e-05,-6.19599499223487e-05,-5.60448869986753e-05,-4.95078759508003e-05,-4.24899144119392e-05,-3.51417350971218e-05,-2.76200411119294e-05,-2.00836408323932e-05,-1.26895776467190e-05,-5.58934880462374e-06,1.07469570079208e-06,7.17268878122028e-06,1.25902384875479e-05,1.72310081792414e-05,2.10188268211363e-05,2.38992837123790e-05,2.58407750238791e-05,2.68349832228288e-05,2.68967844558920e-05,2.60635929041769e-05,2.43941646762272e-05,2.19668966469051e-05,1.88776674783312e-05,1.52372786005066e-05,1.11685619447835e-05,6.80322851399103e-06,2.27853728355407e-06,-2.26613264916256e-06,-6.69272237326124e-06,-1.08678623142220e-05,-1.46660892999242e-05,-1.79728352322812e-05,-2.06871174583342e-05,-2.27238689524617e-05,-2.40158558402492e-05,-2.45151403706223e-05,-2.41940589077292e-05,-2.30456965810165e-05,-2.10838526034107e-05,-1.83425026421565e-05,-1.48747767068911e-05,-1.07514825178316e-05,-6.05921496377958e-06,-8.98101808940704e-07,4.62075595758656e-06,1.03780839980834e-05,1.62494045009442e-05,2.21081024764866e-05,2.78285133527778e-05,3.32889570299522e-05,3.83746456271411e-05,4.29803959583499e-05,4.70130831921132e-05,5.03937790371170e-05,5.30595259712077e-05,5.49647082846489e-05,5.60819908071175e-05,5.64028068810859e-05,5.59373881698709e-05,5.47143399796716e-05,5.27797766655795e-05,5.01960421237471e-05,4.70400501012064e-05,4.34012878561919e-05,3.93795343745774e-05,3.50823507205514e-05,3.06224050329437e-05,2.61146980693183e-05,2.16737569825081e-05,1.74108651617811e-05,1.34313944957208e-05,9.83230336674815e-06,6.69985915549114e-06,4.10763813872721e-06,2.11484856020378e-06,7.65014519436002e-07,8.50493622816704e-08,8.47376891194566e-08,7.56635154525476e-07,2.07638515582213e-06,4.00344153718011e-06,6.48217680679638e-06,9.44334630260524e-06,1.28058704571475e-05,1.64788899946734e-05,2.03640427087370e-05,2.43579055539231e-05,2.83545422472424e-05,3.22480944860014e-05,3.59353542880125e-05,3.93182558495243e-05,4.23062276641441e-05,4.48183493858403e-05,4.67852629523225e-05,4.81507936834338e-05,4.88732442778699e-05,4.89263326732899e-05,4.82997534139468e-05,4.69993512771232e-05,4.50469052269862e-05,4.24795300706261e-05,3.93487122663879e-05,3.57190049663392e-05,3.16664153618334e-05,2.72765245589377e-05,2.26423863749674e-05,1.78622564786259e-05,1.30372070818964e-05,8.26868484932276e-06,3.65607076846908e-06,-7.05699593990838e-07,-4.72839872877413e-06,-8.33259903035016e-06,-1.14495444681017e-05,-1.40227581465864e-05,-1.60093482867789e-05,-1.73809824893486e-05,-1.81245081556136e-05,-1.82422054503264e-05,-1.77516679906359e-05,-1.66853153290864e-05,-1.50895500558671e-05,-1.30235807709003e-05,-1.05579400724207e-05,-7.77273389110339e-06,-4.75566480052249e-06,-1.59987720980260e-06};
   
    // Coefficients trouver avec le site web (0-1, 3-5, 7-10)
    //float32_t coeff[20] = {-54220622909.66125,-9139386833.91592,108005074319.7006,56458912545.19908,-57266996975.93793,
//-178982408271.516,-5221159209.76206,172814867502.733,294081512130.9059,-326529792297.7484,-326529792297.7484,294081512130.9059,172814867502.733,-5221159209.76206,-178982408271.516,-57266996975.93793,56458912545.19908,108005074319.7006,-9139386833.91592,-54220622909.66125};

    float32_t coeff[203]={  -0.006465012712786147,  -0.0034150578910971323,  -0.004019655793372396,  -0.0044522146441703095,  -0.004641718645986473,  -0.00452735686582123,  -0.004065232347244173,  -0.0032341994701279835,  -0.002040928261844917,  -0.0005219865517200063,  0.001256520651256556,  0.0032006928161643273,  0.005195564381078422,  0.0071109211028071466,  0.00881495045118475,  0.010178868201781266,  0.011095962277352092,  0.011483706730583639,  0.011296662766784718,  0.010532601559933248,  0.009231699207379648,  0.0074770805292291515,  0.005390591964735598,  0.0031215955101122515,  0.0008356545393556445,  -0.001297553167598568,  -0.003120484884101791,  -0.004501079521238616,  -0.00534462188299752,  -0.005601730993051311,  -0.00527548156544505,  -0.004420383992699979,  -0.003138768737683833,  -0.0015711182291642584,  0.00011703834361957714,  0.0017497197325694108,  0.00315620951305768,  0.0041893210256827235,  0.004739657390466813,  0.004745885682159571,  0.0042025136272432016,  0.003160471710716635,  0.0017222931543662062,  0.00003412733615982692,  -0.001727892105364069,  -0.003377387423692189,  -0.004734896634399017,  -0.005648526431904148,  -0.006008013981444954,  -0.005758887337614481,  -0.004910658771974078,  -0.0035394180965444117,  -0.00177947113088085,  0.00018840013354873774,  0.002149806061557547,  0.0038791531415544784,  0.005166953564135985,  0.005836353570307074,  0.00576106248436366,  0.00489331771040776,  0.0032528689551768407,  0.0009463220782851209,  -0.0018521038182892613,  -0.004908627099517188,  -0.007954091657961659,  -0.010708382951250716,  -0.012909381756538225,  -0.01434054486639842,  -0.014855367405831746,  -0.014397176132633598,  -0.013008118380284197,  -0.01083765954045296,  -0.008111937567031565,  -0.005165319272564323,  -0.0023338877353945298,  -0.000007627172458612151,  0.0014581672312909703,  0.001778367598663847,  0.0007525672034715444,  -0.0017044050558038995,  -0.005535166699017322,  -0.01053462407143606,  -0.0163619475240646,  -0.02256090915019282,  -0.02858997263051248,  -0.03385963421500334,  -0.03778196892132826,  -0.03981939719281033,  -0.039538150379344286,  -0.03664631573433363,  -0.03102770135843918,  -0.022760797297734347,  -0.012122102263588034,  0.00042284013378878827,  0.014244749347846704,  0.0285925217574838,  0.04264384677819325,  0.05556238094151929,  0.06655955146992652,  0.07495154943523814,  0.08020984418930616,  0.08200050415418049,  0.08020984418930616,  0.07495154943523814,  0.06655955146992652,  0.05556238094151929,  0.04264384677819325,  0.0285925217574838,  0.014244749347846704,  0.00042284013378878827,  -0.012122102263588034,  -0.022760797297734347,  -0.03102770135843918,  -0.03664631573433363,  -0.039538150379344286,  -0.03981939719281033,  -0.03778196892132826,  -0.03385963421500334,  -0.02858997263051248,  -0.02256090915019282,  -0.0163619475240646,  -0.01053462407143606,  -0.005535166699017322,  -0.0017044050558038995,  0.0007525672034715444,  0.001778367598663847,  0.0014581672312909703,  -0.000007627172458612151,  -0.0023338877353945298,  -0.005165319272564323,  -0.008111937567031565,  -0.01083765954045296,  -0.013008118380284197,  -0.014397176132633598,  -0.014855367405831746,  -0.01434054486639842,  -0.012909381756538225,  -0.010708382951250716,  -0.007954091657961659,  -0.004908627099517188,  -0.0018521038182892613,  0.0009463220782851209,  0.0032528689551768407,  0.00489331771040776,  0.00576106248436366,  0.005836353570307074,  0.005166953564135985,  0.0038791531415544784,  0.002149806061557547,  0.00018840013354873774,  -0.00177947113088085,  -0.0035394180965444117,  -0.004910658771974078,  -0.005758887337614481,  -0.006008013981444954,  -0.005648526431904148,  -0.004734896634399017,  -0.003377387423692189,  -0.001727892105364069,  0.00003412733615982692,  0.0017222931543662062,  0.003160471710716635,  0.0042025136272432016,  0.004745885682159571,  0.004739657390466813,  0.0041893210256827235,  0.00315620951305768,  0.0017497197325694108,  0.00011703834361957714,  -0.0015711182291642584,  -0.003138768737683833,  -0.004420383992699979,  -0.00527548156544505,  -0.005601730993051311,  -0.00534462188299752,  -0.004501079521238616,  -0.003120484884101791,  -0.001297553167598568,  0.0008356545393556445,  0.0031215955101122515,  0.005390591964735598,  0.0074770805292291515,  0.009231699207379648,  0.010532601559933248,  0.011296662766784718,  0.011483706730583639,  0.011095962277352092,  0.010178868201781266,  0.00881495045118475,  0.0071109211028071466,  0.005195564381078422,  0.0032006928161643273,  0.001256520651256556,  -0.0005219865517200063,  -0.002040928261844917,  -0.0032341994701279835,  -0.004065232347244173,  -0.00452735686582123,  -0.004641718645986473,  -0.0044522146441703095,  -0.004019655793372396,  -0.0034150578910971323,  -0.006465012712786147};
    // params défini dans l'exemple ? pas vraiment compris
    uint16_t numTaps  = 203;
    float32 firStateF32[2000];
    arm_fir_instance_f32 S;
    
    // Initialisation du filtre et appel de la fonction de filtration
    arm_fir_init_f32(&S, numTaps, &coeff[0], &firStateF32[0], 2000);
    arm_fir_f32(&S, buffer, bufferFiltre , 2000);    
    
    // Changements d'une valeur du buffer pour voir si cela affecte bien le buffer du main (pointeur)
    //    buffer[0] = 333;
        bufferFiltre[1] = 222;
    // Affichage via UART des valeurs dans le buffer ou le buffer filtre  
        UART_1_PutString("3 valeurs filtrees dans fct: \n\r");
        for(uint16_t i = 0; i < 3; i++){
        
            char buffer_test[100]="";
            sprintf(buffer_test,"%e\n\r",bufferFiltre[i]);
            UART_1_PutString(buffer_test);
        
        }
        UART_1_PutString("Fin valeurs filtrees dans fct \n\r");
  }

uint8_t traitementSignal(float32_t *buffer, float32_t *bufferFiltre, uint32_t *AC,uint32_t *DC){
    // À TESTER
    // Extraction des composants AC et DC du signal filtré (trouver max, min, nombre de max, etc.)
    
    // Paramètres À CHANGER selon signal (FAIRE TESTS AVEC MATLAB AVANT DE TESTER LA FONCTION!)
    uint16_t index_start = 0;
    uint16_t index_last  = 0;
    uint16_t lastMax = 0;
    uint16_t lastMin = 0;
    uint16_t cutoffH =  1;
    uint16_t cutoffV = 1;
    int16_t  cutoffVNeg = -1;
    
    // Paramètres esssentiels
    uint8_t compteurMax = 0;
    uint8_t compteurMin = 0;
    uint32_t sommeTot = 0;
    uint32_t sommeMax = 0;
    int32_t  sommeMin = 0;
    
    for(uint16_t i = index_start; i < index_last; i++){
        
        sommeTot += buffer[i];
        
        bool maxTrouver = (i >= lastMax + cutoffH & bufferFiltre[i]>cutoffV & bufferFiltre[i-1]<bufferFiltre[i] & bufferFiltre[i+1]<bufferFiltre[i]);
        if(maxTrouver){
            compteurMax += 1;
            sommeMax += bufferFiltre[i];
            lastMax = i;
        }

        bool minTrouver = (i >= lastMin + cutoffH & bufferFiltre[i]<cutoffVNeg & bufferFiltre[i-1]>bufferFiltre[i] & bufferFiltre[i+1]>bufferFiltre[i]);
        if(minTrouver){
            compteurMin += 1;
            sommeMin += bufferFiltre[i];
            lastMin = i;
        }
    }
    *DC = sommeTot /(index_last-index_start);
    *AC = (sommeMax/compteurMax)-(sommeMin/compteurMin);
    
   return compteurMax;
}

void calculFrequenceCardiaque(uint8_t compteur, uint8_t *bpm) 
{ 
    uint8_t temps_acquisition = 10; // variable à effacer si le temps d'acquisition reste fixe
    *bpm = (compteur/temps_acquisition*60);
}

void calculSaturation(uint32_t AC_red, uint32_t DC_red,uint32_t AC_IR,uint32_t DC_IR, uint8_t *saturation)
{
    float ratio = (AC_red*DC_red)/(AC_IR*DC_IR);
    
    float a = 1.5958422;
    float b = -34.6596622;
    float c = 112.6898759;
    
    *saturation = a*pow(ratio,2) + b*ratio + c; 
}

/* [] END OF FILE */
